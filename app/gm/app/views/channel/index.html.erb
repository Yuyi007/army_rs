<!-- <form id="noticeForm" action="/channel/notice" method="POST" class="form">
  <div class="row">
    <div class="col-md-8">
      <div class="input-group">
        <span class="input-group-addon"><%=t :publish_notice %></span>
        <input id="noticeText" name="noticeText" type="text" value="" class="form-control" />
      </div>
    </div>
    <div class="col-md-2">
      <%= render 'shared/zones' %>
    </div>
    <div class="col-md-2">
      <input type="submit" value="<%=t :publish %>" class="btn btn-warning" />
    </div>
  </div>
</form> -->

<br/>

<form id="chatForm" action="/channel/chat" method="POST" class="form">
  <div class="row">
    <div class="col-md-2">
      <div class="input-group">
        <span class="input-group-addon"><%=t :publish_chat %></span>
        <input id="chatName" name="chatName" type="text" value="<%=t :system %>" class="form-control" />
      </div>
    </div>
    <div class="col-md-5">
      <input id="chatText" name="chatText" type="text" value="" class="form-control" />
    </div>
    <div class="col-md-2">
      <%= render 'shared/zones' %>
    </div>
     <div class="col-md-1">
      <input type="checkbox" id="all_zone" name="all_zone" value=""><%=t :all_zone %>
    </div>
    <br/>
    <br/>
    <div class="col-md-2">
      <input type="color" id="color_1" name="color_1" value="#ffc500"/>
    </div>
    <div class="col-md-1">
      <input type="button" onclick="onClickColor();" value="<%=t :input_color %>" class="btn btn-success"></input>
    </div>
    <div class="col-md-2">
        <input id="input_color_1" name="input_color_1" type="text" value="#ffc500" class="form-control" readonly=true/>
    </div>
    <br/>
    <br/>
    <div class="col-md-2">
      <div class="input-group">
        <span class="input-group-addon"><%=t :frequency_1 %></span>
        <input id="time" name="time" type="text" value="<%=t :preset_time %>" class="form-control" />
      </div>
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-warning" onclick="return sumbit_sure()"><%=t :publish %></button>
    </div>
  </div>
</form>

<br/>
<br/>
<br/>
<form id="scheduleForm" action="/channel/add_chat_schedule" method="POST" class="form">
  <fieldset style="border:11px solid #B5B8C8;padding:10px;margin-bottom:10px;display:block;">
    <div class="row">
      <div class="col-md-2">
        <span><%=t :chat_start_time %></span>
      </div>
      <div class="col-md-2">
        <input id="start_time" name="start_time" type="text" value="" class="form-control" />
      </div>

      <div class="col-md-2">
        <span><%=t :chat_stop_time %></span>
      </div>
      <div class="col-md-2">
        <input id="stop_time" name="stop_time" type="text" value="" class="form-control" />
      </div>

      <div class="col-md-1">
        <span><%=t :chat_interval %></span>
      </div>
      <div class="col-md-1">
        <input id="interval" name="interval" type="text" value="" class="form-control" />
      </div>
      <br/>
      <br/>
      <div class="col-md-2">
        <input type="color" id="color_2" name="color_2" value="#ffc500"/>
      </div>
      <div class="col-md-1">
        <input type="button" onclick="onClickColor_2();" value="<%=t :input_color %>" class="btn btn-success"></input>
      </div>
      <div class="col-md-2">
          <input id="input_color_2" name="input_color_2" type="text" value="#ffc500" class="form-control" readonly=true/>
      </div>
    </div>
    <br/>
    <div class="row">
      <div class="col-md-2">
        <div class="input-group">
          <span class="input-group-addon"><%=t :publish_chat %></span>
          <input id="chatName" name="chatName" type="text" value="<%=t :system %>" class="form-control" />
        </div>
      </div>
      <div class="col-md-5">
        <input id="content" name="content" type="text" value="" class="form-control" />
      </div>
      <div class="col-md-2">
        <select id="zoneInput" name="zone" class="form-control">
          <% RsRails.get_config('zones').each_with_index do |z, i| %>
            <option value='<%= i+1 %>' <%= if params[:zone] == "#{i+1}" then 'selected' else '' end%>>
              <%= "#{i+1}åŒº #{z['name']}" %></option>
          <% end %>
        </select>
      </div>
      <div class="col-md-1">
        <input type="button" onclick="onClickAllZone();" value="all" class="btn btn-success"></input>
      </div>
      <div class="col-md-2">
        <input id="zones" name="zones" type="text" value="" class="form-control" />
      </div>
    </div>
    <br/>
    <div class="col-md-2">
      <div class="input-group">
        <span class="input-group-addon"><%=t :frequency_2 %></span>
        <input id="times" name="times" type="text" value="<%=t :preset_time %>" class="form-control" />
      </div>
    </div>
    <div class="row">
      <div class="col-md-2">
        <input type="submit" value="<%=t :publish %>" class="btn btn-warning" />
      </div>
    </div>
  </fieldset>
</form>

<table class="table table-striped table-bordered table-hover">
  <col />
  <col />
  <col />
  <col />
  <col />
  <col />
  <col />
  <col />
  <col />
  <tr>
    <th>
      <%= t :zone%>
    </th>
    <th>
      <%= t :chat_name %>
    </th>
    <th width=400>
      <%= t :chat_content%>
    </th>
    <th>
      <%= t :chat_start_time%>
    </th>
    <th>
      <%= t :chat_stop_time%>
    </th>
    <th>
      <%= t :chat_interval%>
    </th>
    <th>
      <%= t :times%>
    </th>
    <th>
      <%= t :input_color%>
    </th>
    <th>
      <%= t :actions%>
    </th>
    <th>
    </th>
  </tr>
  <% @scheduleChats.each_with_index do |chat, i| %>
    <tr>
      <td>
        <%= chat.zones.join(',')%>
      </td>
      <td>
        <%= chat.name%>
      </td>
      <td>
        <%= chat.content%>
      </td>
      <td>
        <%= Time.at(chat.start_time).strftime('%Y-%m-%d %H:%M:%S')%>
      </td>
      <td>
        <%= Time.at(chat.stop_time).strftime('%Y-%m-%d %H:%M:%S')%>
      </td>
      <td>
        <%= chat.interval%>
      </td>
      <td>
        <%= chat.times%>
      </td>
      <td>
        <%= chat.color%>
      </td>
      <th>
        <button onclick="deleteChat(<%= i %>);"><%= t :delete%></button>
      </th>
    </tr>
  <% end %>
</table>

<script type="text/javascript">
  function onClickAllZone()
  {
    var str = "1";
    <% (2..RsRails.get_config('zones').length).each do |i| %>
      str += "," + <%= i %>;
    <% end%>
    $("#zones").val(str);
  }

  function onClickColor(){
      var x = document.getElementById('color_1').value;
      $("#input_color_1").val(x);
  };
  function onClickColor_2(){
      var x = document.getElementById('color_2').value;
      $("#input_color_2").val(x);
  };

  function sumbit_sure()
  {
    var name = document.getElementById('chatName').value;
    var content = document.getElementById('chatText').value;
    var zone = document.getElementById('zone').value;
    var color = document.getElementById('input_color_1').value;
    var time = document.getElementById('time').value;
    
    if ($("#all_zone").is(":checked")){
      zone = 0
      $("#all_zone").val(0);
    }
    alert("<%=t(:sender)%> : " + name + ", \n" + "<%=t(:content)%> : " + content + ", \n" + "<%=t(:zone)%> : " + zone + ", \n" + "<%=t(:input_color)%> : " + color + ", \n" + "<%=t(:frequency_1)%> : " + time)
    var gnl=confirm("<%=t(:comfirm_to_submit)%>");
    if (gnl==true)
    {
      return true;
    }
    else
    {
      return false;
    }
  }

  function deleteChat(i)
  {
    $.ajax({
      type: 'POST',
      url: 'remove_chat_schedule',
      data: {'index' : i}
    }).done(function(jsonData){
      console.log(jsonData);
      window.location.reload();
    }).fail(function(xhr, status){
      showStatus('Something wrong!', 'fail');
    });
  };

  $('#start_time').datetimepicker();
  $('#stop_time').datetimepicker();

  function onSelectZone()
  {
    var str = $("#zones").val() 
    if(str == '' || !str){
      str = $("#zoneInput").val()  
    }
    else{
      str +=  "," + $("#zoneInput").val()
    }
    
    $("#zones").val(str);
  };

  $('#zoneInput').change(onSelectZone);

  ajaxSubmit($('#noticeForm'));
  ajaxSubmit($('#chatForm'));
</script>
